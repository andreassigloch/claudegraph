{% extends "base.html" %}

{% block title %}Error {{ error_code }} - {{ super() }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="text-center">
            <!-- Error Icon -->
            <div class="mb-4">
                {% if error_code == 404 %}
                    <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
                {% elif error_code == 500 %}
                    <i class="bi bi-bug display-1 text-danger"></i>
                {% elif error_code == 403 %}
                    <i class="bi bi-lock display-1 text-warning"></i>
                {% elif error_code == 413 %}
                    <i class="bi bi-file-x display-1 text-info"></i>
                {% else %}
                    <i class="bi bi-exclamation-circle display-1 text-secondary"></i>
                {% endif %}
            </div>

            <!-- Error Code -->
            <h1 class="display-4 fw-bold mb-3">
                {% if error_code == 404 %}
                    404
                {% elif error_code == 500 %}
                    500
                {% elif error_code == 403 %}
                    403
                {% elif error_code == 413 %}
                    413
                {% else %}
                    {{ error_code }}
                {% endif %}
            </h1>

            <!-- Error Title -->
            <h2 class="h4 mb-3">
                {% if error_code == 404 %}
                    Page Not Found
                {% elif error_code == 500 %}
                    Internal Server Error
                {% elif error_code == 403 %}
                    Access Forbidden
                {% elif error_code == 413 %}
                    File Too Large
                {% else %}
                    An Error Occurred
                {% endif %}
            </h2>

            <!-- Error Message -->
            <p class="text-muted mb-4">
                {% if error_code == 404 %}
                    The page you're looking for doesn't exist or has been moved.
                {% elif error_code == 500 %}
                    Something went wrong on our end. We're working to fix it.
                {% elif error_code == 403 %}
                    You don't have permission to access this resource.
                {% elif error_code == 413 %}
                    The file you're trying to upload is too large. Maximum size is 16MB.
                {% else %}
                    {{ error_message or "An unexpected error occurred." }}
                {% endif %}
            </p>

            <!-- Additional Details -->
            {% if error_message and error_message != "An unexpected error occurred." %}
            <div class="alert alert-light border mb-4">
                <small class="text-muted">
                    <strong>Details:</strong> {{ error_message }}
                </small>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="d-flex flex-column flex-sm-row gap-2 justify-content-center mb-4">
                <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                    <i class="bi bi-house"></i> Go to Home
                </a>
                
                {% if error_code == 404 %}
                    <button class="btn btn-outline-secondary" onclick="history.back()">
                        <i class="bi bi-arrow-left"></i> Go Back
                    </button>
                {% elif error_code == 413 %}
                    <a href="{{ url_for('main.analyzer_page') }}" class="btn btn-outline-info">
                        <i class="bi bi-cloud-upload"></i> Try Upload Again
                    </a>
                {% elif error_code == 500 %}
                    <button class="btn btn-outline-warning" onclick="window.location.reload()">
                        <i class="bi bi-arrow-clockwise"></i> Retry
                    </button>
                {% else %}
                    <button class="btn btn-outline-secondary" onclick="history.back()">
                        <i class="bi bi-arrow-left"></i> Go Back
                    </button>
                {% endif %}
            </div>

            <!-- Help Section -->
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bi bi-question-circle"></i> Need Help?
                    </h6>
                    <div class="row text-start">
                        <div class="col-md-6">
                            <h6 class="small">Common Solutions:</h6>
                            <ul class="small text-muted">
                                {% if error_code == 404 %}
                                    <li>Check the URL for typos</li>
                                    <li>Use the navigation menu</li>
                                    <li>Start from the dashboard</li>
                                {% elif error_code == 500 %}
                                    <li>Refresh the page</li>
                                    <li>Clear your browser cache</li>
                                    <li>Try again in a few minutes</li>
                                {% elif error_code == 413 %}
                                    <li>Reduce file size</li>
                                    <li>Compress your archive</li>
                                    <li>Remove unnecessary files</li>
                                {% else %}
                                    <li>Refresh the page</li>
                                    <li>Check your connection</li>
                                    <li>Try a different browser</li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="small">Quick Actions:</h6>
                            <div class="d-grid gap-1">
                                <a href="{{ url_for('main.index') }}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-speedometer2"></i> Home
                                </a>
                                <a href="{{ url_for('main.analyzer_page') }}" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-cloud-upload"></i> Upload Project
                                </a>
                                <a href="{{ url_for('main.graph_viewer') }}" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-diagram-3"></i> Graph Viewer
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Session Info -->
            {% if session.get('session_id') %}
            <div class="mt-4">
                <small class="text-muted">
                    Session ID: {{ session.get('session_id')[:12] }}...
                    {% if session.get('created_at') %}
                        | Started: {{ session.get('created_at') | datetime_format('%H:%M') }}
                    {% endif %}
                </small>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Additional Error Info for Development -->
{% if config.DEBUG %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0">
                    <i class="bi bi-bug"></i> Debug Information
                    <small>(Development Mode)</small>
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Request Info:</h6>
                        <ul class="small">
                            <li><strong>Method:</strong> {{ request.method }}</li>
                            <li><strong>URL:</strong> {{ request.url }}</li>
                            <li><strong>Endpoint:</strong> {{ request.endpoint or 'Unknown' }}</li>
                            <li><strong>Remote Address:</strong> {{ request.remote_addr }}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Browser Info:</h6>
                        <ul class="small">
                            <li><strong>User Agent:</strong> {{ request.user_agent.string[:50] }}...</li>
                            <li><strong>Accept Language:</strong> {{ request.accept_languages.best or 'Unknown' }}</li>
                            <li><strong>Referrer:</strong> {{ request.referrer or 'Direct' }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Auto-focus on primary action button
    document.addEventListener('DOMContentLoaded', function() {
        const primaryButton = document.querySelector('.btn-primary');
        if (primaryButton) {
            primaryButton.focus();
        }
    });

    // Keyboard shortcuts for common actions
    document.addEventListener('keydown', function(event) {
        switch(event.key) {
            case 'h':
            case 'H':
                // Home/Dashboard
                if (event.ctrlKey || event.metaKey) {
                    event.preventDefault();
                    window.location.href = '{{ url_for("main.index") }}';
                }
                break;
            case 'Escape':
                // Go back
                event.preventDefault();
                history.back();
                break;
            case 'r':
            case 'R':
                // Refresh/Retry
                if (event.ctrlKey || event.metaKey) {
                    // Don't prevent default - allow normal refresh
                } else {
                    event.preventDefault();
                    window.location.reload();
                }
                break;
        }
    });

    // Add keyboard shortcut hints
    setTimeout(function() {
        const helpText = document.createElement('div');
        helpText.className = 'mt-3 small text-muted';
        helpText.innerHTML = `
            <i class="bi bi-keyboard"></i> 
            <strong>Keyboard shortcuts:</strong> 
            <kbd>Ctrl+H</kbd> Dashboard, 
            <kbd>Esc</kbd> Go back, 
            <kbd>R</kbd> Retry
        `;
        
        const container = document.querySelector('.col-md-8.col-lg-6');
        if (container) {
            container.appendChild(helpText);
        }
    }, 1000);
</script>
{% endblock %}